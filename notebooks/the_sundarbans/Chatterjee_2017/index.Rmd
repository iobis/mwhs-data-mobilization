---
title: Bundling Chatterjee et al. 2017 to a DwC Archive
date: "`r Sys.Date()`"
author: Chandra Earl
output: (function(...) {
  rmdformats::robobook(toc_depth = 4, pandoc_args = c("+RTS", "-K2000m", "-RTS"), ...) })
editor_options: 
  chunk_output_type: console
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding, output_dir = "docs") })  
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook for converting the **species checklist** found in the following reference to DarwinCore format for upload into [OBIS](https://obis.org/) as part of UNESCO's [eDNA Expeditions](https://www.unesco.org/en/edna-expeditions) project:

[Chatterjee, T (2017) State of art report on biodiversity in Indian Sundarbans. Section 2.14. Coastal Fishes. World Wide Fund for Nature-India, New Delhi.](http://support.wwfindia.org/other/State_of_Art_Report.pdf)

# Setup

Call the necessary libraries and environments

```{r}
library(reticulate)
use_condaenv("mwhs-data-mobilization", required = TRUE)
```

# Parsing PDF table to CSV

The data for this reference is formatted as an image-based table inside a PDF across multiple sheets. First, we use [pdf_to_table](https://github.com/sunray1/pdf_to_table) to OCR and parse out the table to a CSV.

```{r}
# Path to the Python script
script <- "../../../scripts/pdf_to_tables/pdf_to_table.py"

# Input PDF file path
input_pdf <- "../../../datasets/the_sundarbans/Chatterjee_2017/raw/Sundarbans-Biodiversity-Pt-3.pdf"

# Output directory
output_dir <- "../../../datasets/the_sundarbans/Chatterjee_2017/processed"

# Define page numbers and table areas (see documentation)
page_args <- c(
  "-p 8 -a 98.593,63.62,762.325,535.376",
  "-p 9 -a 82.222,63.62,762.325,535.376",
  "-p 10 -a 81.478,63.62,762.325,535.376",
  "-p 11 -a 77.758,63.62,762.325,535.376",
  "-p 12 -a 82.222,63.62,762.325,535.376",
  "-p 13 -a 71.805,63.62,770.51,535.376",
  "-p 14 -a 77.758,63.62,763.069,535.376",
  "-p 15 -a 72.549,63.62,769.022,535.376",
  "-p 16 -a 79.99,63.62,762.325,535.376",
  "-p 17 -a 79.246,63.62,762.325,535.376"
)

# Define run parameters (see documentation)
run_parameters <- "-s -c -ocr -# 4"

# Combine page arguments and execute
page_args_combined <- paste(page_args, collapse = " ")
command <- paste("python", script, "-i", input_pdf, run_parameters, page_args_combined, "-o", output_dir)
system(command)
```

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*.

```{r}
plot(cars)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
